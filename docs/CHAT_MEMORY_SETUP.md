# üíæ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –¥–ª—è —á–∞—Ç—ñ–≤

## ‚úÖ –©–æ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ:

1. ‚úÖ –î–æ–¥–∞–Ω–æ –º–æ–¥–µ–ª—ñ `Chat` —Ç–∞ `Message` –≤ Prisma schema
2. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–º—ñ–Ω—É –º–æ–¥–µ–ª—ñ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º—É —á–∞—Ç—ñ
3. ‚úÖ –î–æ–¥–∞–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ –ë–î
4. ‚úÖ –î–æ–¥–∞–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É
5. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ API endpoints –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —á–∞—Ç–∞–º–∏

## üìã –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏:

### 1. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DATABASE_URL

–í—ñ–¥–∫—Ä–∏–π—Ç–µ `.env` —Ñ–∞–π–ª —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `DATABASE_URL` –º—ñ—Å—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π connection string –≤—ñ–¥ Neon:

```env
DATABASE_URL="postgresql://user:password@ep-xxx-xxx.region.aws.neon.tech/neondb?sslmode=require"
```

**–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ connection string:**
1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ https://console.neon.tech/
2. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Connection Details"
4. –°–∫–æ–ø—ñ—é–π—Ç–µ connection string

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –ë–î

```powershell
cd E:\–ø—Ä–æ–µ–∫—Ç–∏\ai-generator
npx prisma db push
```

–ê–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é:
```powershell
npx prisma migrate dev --name add_chat_and_message
```

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```powershell
npx prisma studio
```

–í—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è Prisma Studio, –¥–µ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—ñ `Chat` —Ç–∞ `Message`.

## üîß –Ø–∫ –ø—Ä–∞—Ü—é—î:

### –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:
- –ü—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è/–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —á–∞—Ç
- –í—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ `Message`
- –ö–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î `chatId` –¥–ª—è –∑–≤'—è–∑–∫—É –∑ —á–∞—Ç–æ–º

### –ó–º—ñ–Ω–∞ –º–æ–¥–µ–ª—ñ:
- –ü—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–¥–µ–ª—ñ –≤–æ–Ω–∞ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ –ë–î
- –ù–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É –º–æ–¥–µ–ª—å
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `useRef` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó:
- –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —á–∞—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —ñ—Å—Ç–æ—Ä—ñ—è
- API endpoint: `GET /api/chat/history/[chatId]`
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É

## üì° API Endpoints:

### POST /api/chat
–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º

**Body:**
```json
{
  "model": "gpt-5.1",
  "messages": [...],
  "stream": true,
  "chatId": "optional-chat-id"
}
```

### GET /api/chat/history/[chatId]
–û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É

**Response:**
```json
{
  "chatId": "...",
  "model": "gpt-5.1",
  "title": "–ù–∞–∑–≤–∞ —á–∞—Ç—É",
  "messages": [...],
  "createdAt": "...",
  "updatedAt": "..."
}
```

### PATCH /api/chat/[chatId]/model
–û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ —á–∞—Ç—É

**Body:**
```json
{
  "model": "claude-4.5-sonnet"
}
```

## üêõ Troubleshooting:

### –ü–æ–º–∏–ª–∫–∞: "Can't reach database server"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `DATABASE_URL` –≤ `.env`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ connection string –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Neon –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –∞–∫—Ç–∏–≤–Ω–∞

### –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î `chatId` –≤ –∑–∞–ø–∏—Ç—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –º—ñ–≥—Ä–∞—Ü—ñ—è –ë–î –≤–∏–∫–æ–Ω–∞–Ω–∞

### –ó–º—ñ–Ω–∞ –º–æ–¥–µ–ª—ñ –Ω–µ –ø—Ä–∞—Ü—é—î
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è `currentModelRef`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è API endpoint –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:

### –¢–∞–±–ª–∏—Ü—è Chat:
- `id` - ID —á–∞—Ç—É
- `userId` - ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `title` - –ù–∞–∑–≤–∞ —á–∞—Ç—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ –ø–µ—Ä—à–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)
- `model` - –ü–æ—Ç–æ—á–Ω–∞ –º–æ–¥–µ–ª—å —á–∞—Ç—É
- `createdAt` - –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- `updatedAt` - –î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### –¢–∞–±–ª–∏—Ü—è Message:
- `id` - ID –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `chatId` - ID —á–∞—Ç—É
- `role` - –†–æ–ª—å (user, assistant, system)
- `content` - –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `model` - –ú–æ–¥–µ–ª—å, —è–∫–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–¥–ª—è assistant)
- `images` - JSON –∑ –º–∞—Å–∏–≤–æ–º –∑–æ–±—Ä–∞–∂–µ–Ω—å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- `tokens` - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —Ç–æ–∫–µ–Ω–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- `createdAt` - –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è

## üéØ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. –î–æ–¥–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏ —á–∞—Ç
3. –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–¥–∞–ª–∏—Ç–∏ —á–∞—Ç
4. –î–æ–¥–∞—Ç–∏ –ø–æ—à—É–∫ –ø–æ —á–∞—Ç–∞—Ö
5. –î–æ–¥–∞—Ç–∏ –µ–∫—Å–ø–æ—Ä—Ç —á–∞—Ç—É
