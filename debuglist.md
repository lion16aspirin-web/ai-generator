# Debuglist

> Примітка: інструкція “використовуй context7” виконана настільки, наскільки доступні інструменти; у цьому середовищі інструмент/контекст `context7` не доступний. Планування виконано на основі наявного коду та ROADMAP.

## Непрацююче / недороблене (з коду)
- Реєстрація користувача: `register` сторінка має заглушку в `handleSubmit` і не викликає реальний API/створення користувача. 【F:src/app/[locale]/register/page.tsx†L22-L42】
  - План виправлення:
    1) Додати API endpoint для реєстрації (валідація payload, перевірка унікальності email, хешування пароля, створення користувача).
    2) Підʼєднати `handleSubmit` до нового endpoint і показувати помилки з бекенду.
    3) Додати тест/перевірку сценарію реєстрації (мінімум e2e/інтеграційний smoke).
- Облік використаних токенів: поле `used` завжди 0, трекінг фактичного використання не реалізований. 【F:src/lib/utils/tokens.ts†L15-L30】
  - План виправлення:
    1) Додати модель/таблицю `TokenTransaction` або аналог для обліку використаних токенів.
    2) Оновити `getUserTokens`, щоб рахував `used` на основі транзакцій за період.
    3) Додати міграцію Prisma та індекси для швидких агрегацій.
- Лог транзакцій токенів: у `deductTokens` є TODO для логування транзакцій (зараз лише `console.log`). 【F:src/lib/utils/tokens.ts†L42-L69】
  - План виправлення:
    1) Реалізувати запис транзакцій у БД при списанні/додаванні токенів.
    2) Стандартизувати причини транзакцій (enum) для аналітики.
    3) Додати мінімальний audit‑лог і endpoint для перегляду історії.
- Скасування відео: при cancel немає повернення частини токенів (TODO). 【F:src/app/api/video/cancel/[id]/route.ts†L46-L55】
  - План виправлення:
    1) Зʼясувати стан/прогрес генерації перед cancel (через API провайдера).
    2) Визначити політику рефанду (часткове/повне повернення) і зберегти транзакцію.
    3) Оновити endpoint з логікою повернення і покриттям тестами.
- Адмін‑перевірка: в `GET /api/admin/models/status` немає реальної перевірки ролі адміна (TODO). 【F:src/app/api/admin/models/status/route.ts†L155-L178】
  - План виправлення:
    1) Додати перевірку ролі `ADMIN` через session + запит до БД.
    2) Повернути 403 для неадмінів.
    3) Додати тести доступу (admin/non‑admin).

## Непрацююче / недороблене (за ROADMAP)
- Реєстрація: валідація полів, перевірка email та email‑підтвердження — не реалізовано. 【F:ROADMAP.md†L63-L72】
  - План виправлення:
    1) Додати схеми валідації (zod) для реєстраційної форми.
    2) Реалізувати унікальність email на рівні БД/апі.
    3) (Опц.) Додати email‑верифікацію через токени підтвердження.
- AI інтеграції (images/video/animation): більшість провайдерів позначені як pending (DALL‑E, Replicate, Ideogram, Recraft, Sora, Veo, Kling, PixVerse тощо). 【F:ROADMAP.md†L135-L168】
  - План виправлення:
    1) Узгодити список пріоритетних провайдерів і їхній order‑of‑implementation.
    2) Додати адаптери для кожного провайдера + мапінг моделей.
    3) Включити fallback/feature flags і логування помилок.
- Монетизація: Lemon Squeezy, NOWPayments, Telegram Stars — не інтегровано. 【F:ROADMAP.md†L200-L243】
  - План виправлення:
    1) Завести базові тарифні плани та webhook‑обробники.
    2) Підʼєднати провайдери оплати по черзі з перевіркою статусів.
    3) Додати синхронізацію токенів із платежами та аудит.
- UI для генерації: завантаження результатів — не реалізовано. 【F:ROADMAP.md†L172-L179】
  - План виправлення:
    1) Додати API/endpoint для отримання та видачі файлів (signed URLs).
    2) Додати UI‑кнопки “Download” для image/video/animate.
    3) Додати аналітику успішних/помилкових завантажень.
